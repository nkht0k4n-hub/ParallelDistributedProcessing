2026/01/26 並列分散

電子メールのデータの流れや技術についてまとめる.

電子メールとはある利用者が作成したを別の利用者に届けるサービスである.
テキストの形式はRFC 5322で定められている.
RFCとはインターネット技術標準化団体のIEtFが正式に発行する文書であり,インターネットで利用されるプロトコルや,その他のインターネットに関わる様々な技術の使用,要件が通し番号を付けて公開されている.


電子メールで様々なファイルを扱えるようにする規格としてMIMEがある.
MIMEではバイナリデータや画像などのファイルをBase64で文字列に変換して送信を可能にする.

次にデータの流れを説明する.
RFC822形式(廃止されている)のテキストを送信者が作成.
->SMTPでMTAに渡す.
->MTAが受信側のMTAにSMTPなどの手段で渡す.
->受信側のMTAは受け取ったテキストをファイルに保存する.
->受信側のMUAはテキストを受け取る.

ここでファイルに保存された電子メールを別の計算機からアクセスするプロトコルとしてPOPとIMAPがある.
POPではユーザーがタイトルや発信者を確認する前に全メールを受信.
メールはクライアントに保存する.

IMAPではメールをサーバーに保存して
,タイトルや発信者を見て受信するか決められる.

SPFとは送信元のIPアドレスが偽物でないかを確認する.
SPFではメール送信時に使用したメールサーバーのIPアドレスを送信側のDNSにSPFレコードとして登録する.受信側は受信する時に送信側のSPFレコードと照合してなりすましかどうかを判断する.


DKIMとはメール送信者がメールに電子署名を付与
して,メール受信者が受け取り時にDNSサーバーに問い合わせ,ドメインの公開鍵情報を得る.
それを用いて電子署名を検証する.
IPアドレスは確認しないが,ドメインに紐づく公開鍵を確認する.

SPFだけでは認証としては不十分であると言える.これは中継サーバーなどが改変されているとIPを変えずに内容を改竄される可能性があるためである.

SPF,DKIMを利用する認証として注目を集めているDMARCについて説明する.
これはSPFやDKIMの認証が失敗した場合の対応策を定めたものである.送信側が認証失敗時の
推奨アクションをDNSにDMARCポリシーとして宣言しておき,受信側は認証失敗時にそれを参照するというものである.
また,SPF,DKIMでは確認しないFromヘッダのドメインも確認する.Fromヘッダのドメインは相手が自由に書くことが出来る表示用のドメインである.

各MTAがSPF,DKIM,DMARCの検証結果を記録するヘッダとしてARCヘッダに記録する.












